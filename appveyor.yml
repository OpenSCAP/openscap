version: master-{build}
branches:
  only:
  - master
image: Visual Studio 2017
configuration: Release
clone_folder: c:\projects\openscap

environment:
  matrix:
    - PYTHON_VERSION: 36

init:
- set PATH=C:\Python%PYTHON_VERSION%;%PYTHON%\Scripts;C:\ProgramData\chocolatey\lib\swig\tools;%PATH%

install:
- choco install swig
- choco install doxygen.install
# update vcpkg
- cmd: cd C:\tools\vcpkg
- cmd: git pull
- cmd: .\bootstrap-vcpkg.bat
- cmd: vcpkg version
# remove outdated versions
- cmd: vcpkg remove --outdated --recurse
# install required dependencies
- cmd: vcpkg install curl libxml2 libxslt bzip2 pcre pthreads
# return back to build root
- cmd: cd "%APPVEYOR_BUILD_FOLDER%"

cache: c:\tools\vcpkg\installed\

before_build:
- cmd: >-
    cd build

    cmake -DCMAKE_TOOLCHAIN_FILE=c:/tools/vcpkg/scripts/buildsystems/vcpkg.cmake ..

build:
  project: c:\projects\openscap\build\openscap.sln
  verbosity: minimal
after_build:
  - cmd: cpack
artifacts:
  - path: build\OpenSCAP*.msi
    name: Windows Installer
  - path: build\OpenSCAP*.msi.sha512
    name: SHA512 checksum
